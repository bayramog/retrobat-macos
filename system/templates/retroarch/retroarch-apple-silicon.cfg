# RetroArch Optimal Configuration for Apple Silicon
# Save this as: ~/.config/retroarch/retroarch.cfg.apple-silicon
# 
# This configuration is optimized for Apple Silicon Macs (M1, M2, M3, etc.)
# It leverages Metal API, unified memory architecture, and ARM64 optimizations
#
# To use: Copy this file to ~/.config/retroarch/retroarch.cfg
# Or: Load as override in RetroArch Settings > Configuration

# ============================================================================
# VIDEO SETTINGS - Optimized for Metal and Apple Silicon
# ============================================================================

# Use Metal video driver (native to Apple Silicon)
video_driver = "metal"

# Enable V-Sync for smooth frame pacing
video_vsync = "true"

# Disable hard sync (not needed with Metal)
video_hard_sync = "false"

# Frame delay - 0 for lowest latency
video_frame_delay = "0"

# Maximum swapchain images (triple buffering)
video_max_swapchain_images = "3"

# Enable threaded video (better performance)
video_threaded = "true"

# Smooth scaling
video_smooth = "true"

# Bilinear filtering
video_filter = ""

# Aspect ratio
aspect_ratio_index = "23"  # Core provided

# Shader support (Metal shaders - .slang)
video_shader_enable = "false"  # Enable when using shaders
video_shader_dir = "~/.config/retroarch/shaders"

# ============================================================================
# AUDIO SETTINGS - Optimized for CoreAudio
# ============================================================================

# Use CoreAudio (native macOS audio)
audio_driver = "coreaudio"
audio_enable = "true"

# Audio sync (important for emulation accuracy)
audio_sync = "true"

# Low latency (64ms is good balance for most systems)
audio_latency = "64"

# Audio rate control
audio_rate_control = "true"
audio_rate_control_delta = "0.005"

# Max timing skew
audio_max_timing_skew = "0.05"

# Volume
audio_volume = "0.0"  # dB (0.0 = 100%)

# ============================================================================
# INPUT SETTINGS - Optimized for macOS
# ============================================================================

# Input driver
input_driver = "cocoa"

# Joypad driver (HID is universal)
input_joypad_driver = "hid"

# Auto-detect controllers
input_autodetect_enable = "true"

# Poll type (early is better for latency)
input_poll_type_behavior = "0"

# Max users
input_max_users = "4"

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================

# Disable rewind (CPU intensive)
rewind_enable = "false"

# Disable run-ahead (use only if you need it and have CPU headroom)
run_ahead_enabled = "false"
run_ahead_frames = "0"

# Fast forward settings
fastforward_ratio = "0.0"  # Unlimited
pause_nonactive = "false"

# ============================================================================
# MENU SETTINGS
# ============================================================================

# Menu driver (ozone is modern and efficient)
menu_driver = "ozone"

# Enable menu
menu_enable = "true"

# Menu scale
menu_scale_factor = "1.0"

# DPI override
menu_dpi_override_enable = "false"

# ============================================================================
# CORE SETTINGS
# ============================================================================

# Core options
core_updater_auto_extract_archive = "true"

# Save states
savestate_auto_save = "true"
savestate_auto_load = "true"
savestate_thumbnail_enable = "true"

# Save files
savefile_directory = "~/.config/retroarch/saves"
savestate_directory = "~/.config/retroarch/states"

# ============================================================================
# DIRECTORY SETTINGS
# ============================================================================

libretro_directory = "~/.config/retroarch/cores"
libretro_info_path = "~/.config/retroarch/info"
core_assets_directory = "~/.config/retroarch/assets"
assets_directory = "~/.config/retroarch/assets"
dynamic_wallpapers_directory = "~/.config/retroarch/assets/wallpapers"
thumbnails_directory = "~/.config/retroarch/thumbnails"
playlist_directory = "~/.config/retroarch/playlists"
rgui_config_directory = "~/.config/retroarch/config"
video_shader_dir = "~/.config/retroarch/shaders"
video_filter_dir = "~/.config/retroarch/filters/video"
audio_filter_dir = "~/.config/retroarch/filters/audio"
screenshot_directory = "~/.config/retroarch/screenshots"
recording_output_directory = "~/.config/retroarch/recordings"
recording_config_directory = "~/.config/retroarch/records_config"

# ============================================================================
# NETWORK SETTINGS
# ============================================================================

# Network
network_cmd_enable = "false"
stdin_cmd_enable = "false"

# Netplay (enable if needed)
netplay_enable = "false"

# ============================================================================
# MISC SETTINGS
# ============================================================================

# Logging
log_verbosity = "false"
frontend_log_level = "1"

# FPS display (disable for performance)
fps_show = "false"

# Notifications
video_font_enable = "true"
video_msg_pos_x = "0.05"
video_msg_pos_y = "0.05"

# Config save on exit
config_save_on_exit = "true"

# ============================================================================
# APPLE SILICON SPECIFIC OPTIMIZATIONS
# ============================================================================

# These settings leverage Apple Silicon's unique features:
# 
# 1. Unified Memory Architecture
#    - No explicit GPU memory transfers needed
#    - Metal driver handles this automatically
#    - Reduced latency for texture updates
#
# 2. Metal API Benefits
#    - Lower overhead than OpenGL
#    - Better integration with macOS
#    - Tile-based deferred rendering
#
# 3. Performance Cores Utilization
#    - Threaded video helps utilize both P and E cores
#    - macOS QoS handles core assignment
#
# 4. Power Efficiency
#    - V-Sync prevents unnecessary rendering
#    - CoreAudio is optimized for Apple hardware
#    - Disabled features reduce CPU/GPU load

# ============================================================================
# SHADER RECOMMENDATIONS FOR APPLE SILICON
# ============================================================================

# For best performance with shaders on Apple Silicon:
# 
# Lightweight shaders (60 FPS easy):
# - crt-easymode.slangp
# - zfast-crt.slangp
# - lcd-shader.slangp
#
# Medium shaders (may need adjustment):
# - crt-royale.slangp (reduce quality settings)
# - xbrz-freescale.slangp
#
# Heavy shaders (use sparingly):
# - crt-royale-kurozumi.slangp (full quality)
# - mdapt.slangp
#
# To enable shader:
# video_shader_enable = "true"
# video_shader = "~/.config/retroarch/shaders/shaders_slang/crt/crt-easymode.slangp"

# ============================================================================
# CORE-SPECIFIC RECOMMENDATIONS
# ============================================================================

# Some cores have ARM64-specific optimizations:
#
# Best performance:
# - nestopia_libretro (NES)
# - snes9x_libretro (SNES)
# - genesis_plus_gx_libretro (Genesis)
# - gambatte_libretro (Game Boy)
# - mgba_libretro (GBA)
#
# Good performance:
# - pcsx_rearmed_libretro (PlayStation)
# - beetle_psx_hw_libretro (PlayStation, requires more GPU)
# - flycast_libretro (Dreamcast)
#
# Moderate performance (may need tweaking):
# - mupen64plus_next_libretro (N64)
# - parallel_n64_libretro (N64)
# - ppsspp_libretro (PSP)
#
# Core options can be adjusted in:
# ~/.config/retroarch/config/[core_name]/[core_name].opt

# ============================================================================
# BATTERY OPTIMIZATION (MacBooks)
# ============================================================================

# For better battery life on MacBooks:
# 
# 1. Reduce audio latency to 128ms (less frequent processing)
#    audio_latency = "128"
#
# 2. Disable unnecessary features
#    video_shader_enable = "false"
#    rewind_enable = "false"
#    run_ahead_enabled = "false"
#
# 3. Enable V-Sync (prevents over-rendering)
#    video_vsync = "true"
#
# 4. Use simpler video filters
#    video_smooth = "false"
#
# 5. Lower internal resolution multipliers for 3D cores

# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# If you experience issues:
#
# Problem: Audio crackling
# Solution: Increase audio_latency to 128 or 192
#
# Problem: Video stuttering
# Solution: Enable video_threaded, adjust video_max_swapchain_images
#
# Problem: Input lag
# Solution: Decrease audio_latency, disable rewind and run-ahead
#
# Problem: Poor performance
# Solution: Disable shaders, check for thermal throttling
#
# Problem: High CPU usage
# Solution: Close other apps, check core options, disable rewind

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
